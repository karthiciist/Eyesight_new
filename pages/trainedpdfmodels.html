<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Dashboard">
  <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
  <title>Welcome to EYESIGHT</title>

  <!-- Favicons -->
  <link href="img/favicon.png" rel="icon">
  <link href="img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Bootstrap core CSS -->
  <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!--external css-->
  <link href="lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="css/zabuto_calendar.css">
  <link rel="stylesheet" type="text/css" href="lib/gritter/css/jquery.gritter.css" />
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet">
  <script src="lib/chart-master/Chart.js"></script>

</head>

<body>
  <section id="container">
 
    <header class="header black-bg">
      <div class="sidebar-toggle-box">
        <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
      </div>
      <!--logo start-->
      <a href="dashboard.html" class="logo"><b>EY<span>ESIGHT</span></b></a>
      <!--logo end-->
      <div class="top-menu">
        <ul class="nav pull-right top-menu">
          <li><a class="logout" href="/eyesight">Logout</a></li>
        </ul>
      </div>
    </header>
    <aside>
      <div id="sidebar" class="nav-collapse ">
        <ul class="sidebar-menu" id="nav-accordion">
          <li class="mt">
            <a href="dashboard.html">
              <i class="fa fa-dashboard"></i>
              <span>Dashboard</span>
              </a>
          </li>
          <li class="sub-menu">
            <a href="ocrsolutions.html">
              <i class="fa fa-eye"></i>
              <span>OCR Solutions</span>
              </a>
          </li>
          <li class="sub-menu">
            <a href="trainedmodels.html">
              <i class="fa fa-th"></i>
              <span>Trained models</span>
              </a>
          </li>
          <li class="sub-menu">
            <a href="createmodelwithmodal.html">
              <i class="fa fa-plus-square-o"></i>
              <span>Create a model</span>
              </a>
          </li>
          <li class="sub-menu">
            <a href="modelstoretrain.html">
              <i class="fa fa-refresh"></i>
              <span>Retrain a model</span>
              </a>
          </li>
          <li class="sub-menu">
            <a href="pdfoperations.html">
              <i class="fa fa-cogs"></i>
              <span>PDF Operations</span>
              </a>
          </li>
          <li class="sub-menu">
            <a class="active"  href="trainedpdfmodels.html">
              <i class="fa fa-cogs"></i>
              <span>PDF Trained models</span>
              </a>
          </li>
          <li class="sub-menu">
            <a href="helpcenter.html">
              <i class="fa fa-book"></i>
              <span>Help center</span>
              </a>
          </li>
          <li class="sub-menu">
            <a href="javascript:;">
              <i class="fa fa-cogs"></i>
              <span>Settings</span>
              </a>
          </li>
      </div>
    </aside>

    <div style="padding-top: 200px;" id="emptyscreen">
      <center>
        <!-- <div style='position:relative; padding-bottom:calc(100.00% + 44px)'><iframe src='https://gfycat.com/ifr/BruisedFalseBordercollie' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div><p> <a href="https://gfycat.com/bruisedfalsebordercollie">via Gfycat</a></p> -->
        <img src="img/loading.gif" alt="Smiley face" width="150" height="150">
        <!-- <p>No models created so far...</p> -->
      </center>
    </div>

    <section id="main-content">

      <div class="grid-container" style="grid-auto-flow: row; margin-left:2%; padding-top: 5%; padding-right: 1%;" id = "modelcontainer">
      </div>

    </section>

    <!-- DeleteModal -->
    <div class="modal fade" id="myModal2" role="dialog">
      <div class="modal-dialog" style="width: 350px;">

        <!-- DeleteModal content-->
        <div class="modal-content">
          <div class="modal-body" style="padding:30px 30px;">
            <div>
              <center>
                <p id="deletetext">
                </p>
              </center>
            </div>
            <div>
              <center>
                <button class="btn-cardsave" id="cancelbtn" type="button" style="width:100px" class="btn-consumenow">Cancel</button>
                <button class="btn-cardsave" id="deletebtn" type="button" style="width:100px" class="btn-consumenow">Delete</button>
              </center>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Model view Modal -->
    <div class="modal fade" id="myModal" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">

          <div class="modal-header" style="padding:10px 10px;">
            <button type="button" class="close" data-dismiss="modal" id="closebtn">&times;</button>
            <center>
              <h4 style="color: white;" id="modaltitle">Model Details</h4>
              <h5 style="color: white;" id="ocrtype">OCR details</h5>
            </center>
          </div>

          <div class="modal-body" style="padding:10px 50px;">
            <center>
              <div style="display: table-row; width: 100%;">
                <div style="display: table-cell; width: 50%; padding-right: 10px;">
                  <h5 style="font-weight: bold;">Full Height :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputfullheight" placeholder="Extracting text..." readonly="readonly">
                  </div>
                </div>
    
                <div style="display: table-cell; width: 50%; padding-left: 10px;">
                  <h5 style="font-weight: bold;">Full Width :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputfullwidth" placeholder="Extracting text..." readonly="readonly">
                  </div>
                </div>
              </div>
            </center>

            <center>
              <div style="display: table-row; width: 100%;">
                <div style="display: table-cell; width: 50%; padding-right: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Header Captured :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputheader" placeholder="Extracting text..." readonly="readonly">
                  </div>
                </div>
    
                <div style="display: table-cell; width: 50%; padding-left: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Footer Captured :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputfooter" placeholder="Extracting text..." readonly="readonly">
                  </div>
                </div>
              </div>
            </center>

            <center>
              <div style="display: table-row; width: 100%;">
                <div style="display: table-cell; width: 50%; padding-right: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Left Index Captured :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputleftindex" placeholder="Extracting text..." readonly="readonly">
                  </div>
                </div>
    
                <div style="display: table-cell; width: 50%; padding-left: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Total Parameters :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputtotalparam" placeholder="Extracting text..." readonly="readonly">
                  </div>
                </div>
              </div>
            </center>

            <center>
              <div style="display: table-row; width: 100%;">
                <div style="display: table-cell; width: 50%; padding-right: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Default Threshold Value :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputdefthre" placeholder="Extracting text...">
                  </div>
                </div>
    
                <div style="display: table-cell; width: 50%; padding-left: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Default Colorcut Value :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputdefcolcut" placeholder="Extracting text...">
                  </div>
                </div>
              </div>
            </center>

            <center>
              <div style="display: table-row; width: 100%;">
                <div style="display: table-cell; width: 50%; padding-right: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Default Eyesight Range (X) :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputdefeyerangex" placeholder="Extracting text...">
                  </div>
                </div>
    
                <div style="display: table-cell; width: 50%; padding-left: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Default Eyesight Range (Y) :</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputdefeyerangey" placeholder="Extracting text...">
                  </div>
                </div>
              </div>
            </center>

            <center>
              <div style="display: table-row; width: 100%;">
                <div style="display: table-cell; width: 50%; padding-right: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Default Dilate:</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputdefdilate" placeholder="Extracting text...">
                  </div>
                </div>
    
                <div style="display: table-cell; width: 50%; padding-left: 10px;">
                  <h5 style="font-weight: bold; margin-top: 20px;">Default Erode:</h5>
                  <div style="font-weight:bolder; font-style: italic;">
                    <input type="text" class="form-control" id="inputdeferode" placeholder="Extracting text...">
                  </div>
                </div>
              </div>
            </center>

            <div id="apiblock" style="border:1px solid gray; padding-left: 5px; margin-top: 10px;">
              <div class="checkbox" id="thrediv">
                <label><input type="checkbox" value="" onchange="showapioptions(this)" id="apicheckbox">Expose this model as API</label>
              </div>
              <div id="apioptions">
                
                <div style="margin-right: 5px; margin-bottom: 5px;">
                  <div>
                    <h5 style="font-weight: bold; margin-top: 5px;">URL :</h5>
                  </div>
                  <div style="font-weight:bolder; font-style: italic; display: inline-flex; width: 100%;">
                    <!-- <p id="foundtxt">Extracting text...</p> -->
                    <input type="text" class="form-control" id="apiurl" value="http://consumesampleocrmodel.eyesight.com" readonly="readonly">
                    <button type="button" class="apicopybtn" id="btncpyurl">Copy</button>
                  </div>
  
                  <div>
                    <h5 style="font-weight: bold; margin-top: 5px;">API Key :</h5>
                  </div>
                  <div style="font-weight:bolder; font-style: italic; display: inline-flex; width: 100%;">
                    <!-- <p id="foundtxt">Extracting text...</p> -->
                    <input type="text" class="form-control" id="apikey" value="A8JD93MFK3JMFIKK30058DJNMCK3" readonly="readonly">
                    <button type="button" class="apicopybtn" id="btncpykey">Copy</button>
                  </div>
                  <div style="margin-top: 5px;"><a href="abc.com">Learn more about how to consume this API</a></div>
                </div>               
              </div>
              
            </div>

            <div>
              <div>
                <center>
                  <button class="btn-cardsave" id="savedata" type="button" style="width:100px" class="btn-consumenow" onclick="savedata()">Save</button>
                  <button class="btn-cardsave" id="close" type="button" style="width:100px" class="btn-consumenow" data-dismiss="modal">Close</button>
                </center>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    

  <script src="lib/jquery/jquery.min.js"></script>
  <script src="lib/bootstrap/js/bootstrap.min.js"></script>
  <script class="include" type="text/javascript" src="lib/jquery.dcjqaccordion.2.7.js"></script>
  <script src="lib/jquery.scrollTo.min.js"></script>
  <script src="lib/jquery.nicescroll.js" type="text/javascript"></script>
  <script src="lib/jquery.sparkline.js"></script>
  <!--common script for all pages-->
  <script src="lib/common-scripts.js"></script>
  <script type="text/javascript" src="lib/gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="lib/gritter-conf.js"></script>
  <!--script for this page-->
  <script src="lib/sparkline-chart.js"></script>
  <script src="lib/zabuto_calendar.js"></script>
  <script type="application/javascript">

  fetchmodels();

  $(document).ready(function() {
    $("#apioptions").css("display", "none");

    var apiurl = document.getElementById("apiurl");
    var apikey = document.getElementById("apikey");

    btncpyurl.onclick = function() {
      apiurl.select();    
      document.execCommand("copy");
    }

    btncpykey.onclick = function() {
      apikey.select();    
      document.execCommand("copy");
    }

    if ($(apicheckbox).is(":checked")) {
      $("#apioptions").css("display", "inline");
    } else {
      $("#apioptions").css("display", "none");
    }
  });

  function formcard(modelnames){

    // var modelcontainer = '<div style="margin-left:16%; padding-top: 5%; padding-right: 1%" id = "modelcontainer"><div class="row" id="row"></div></div>'
    // var modelcontainer = '<section id="main-content"><section class="wrapper site-min-height"><div style="margin-left:2%; padding-top: 2%; padding-right: 1%" id = "modelcontainer"><div class="row" id="row"></div></div></section></section>'
    // var container = document.createElement('div');
    // container.innerHTML = modelcontainer;
    // document.body.appendChild(container);

    for (modelname in modelnames){

      model = modelnames[modelname];
      btnname = 'btn' + model
      dltbtnname = 'dltbtn' + model

      var html = '<div class="cardpdf"><h3 id ="modelname">' + model + '</h3><p>Description</p><a href="pdfconsume.html"><button class="btn-consumenow" id="' + btnname + '" onclick="sendtoconsume(\'' + model + '\')">' + 'Consume now' + '</button></a><div><center><button class="btn-viewnow" id="' + btnname + '" onclick="sendtoview(\'' + model + '\')">' + 'View' + '</button><button class="btn-deletenow" id="' + btnname + '" onclick="sendtodelete(\'' + model + '\')">' + 'Delete' + '</button></center></div></div>'
      var card = document.createElement('div');
      card.setAttribute('id', model + 'flashcard');
      card.innerHTML = html;
      var col = document.getElementById("modelcontainer");
      col.appendChild(card);
      document.getElementById(model+ "flashcard").style.marginRight = "1%";
    }
    console.log(modelnames.length);
    if (modelnames.length > 0){
      var empty = document.getElementById("emptyscreen");
      empty.style.display = "none";
    }
  }

  function sendtoconsume(model){
    // alert(model);
    localStorage.setItem("modelname", model);
    var name=localStorage.getItem("modelname");
    // alert(name);
    // window.location.href = 'file:///C:/Users/ET437GL/Documents/EYESIGHT/cropper/consumemodel.html'
  }

  function sendtodelete(model){
    // alert(model);
    document.getElementById("deletetext").innerHTML = "Delete " + model + "?";
    $("#myModal2").modal();

    document.getElementById("cancelbtn").onclick = function (event) {
      $('#myModal2').modal('hide');
    }

    document.getElementById("deletebtn").onclick = function (event) {
      $('#myModal2').modal('hide');
      var http = new XMLHttpRequest();
      var url = 'http://localhost:3000/deletepdfmodel';
      var params = 'model=' + model;
      http.open('POST', url, true);

      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

      http.onreadystatechange = function () {
        if(http.readyState == 4 && http.status == 200) {
          if (http.status == 200){
            alert("deleted model")
            location.reload();
          } else {
            alert("failed to delete a model")
            location.reload();
          }
        }
      }
      http.send(params);
    }

    // localStorage.setItem("modelname", model);
    // var name=localStorage.getItem("modelname");
    // alert(name);
    // window.location.href = 'file:///C:/Users/ET437GL/Documents/EYESIGHT/cropper/consumemodel.html'
  }

  function sendtoview(model){
    // alert(model);
    console.log(model);

    document.getElementById("savedata").onclick = function (event) {
      savedata(model);
    }

    var http = new XMLHttpRequest();
    var url = 'http://localhost:3000/getmodeledtails';
    var params = 'model=' + model;
    http.open('POST', url, true);

    http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

    http.onreadystatechange = function () {
      if (http.readyState == 4 && http.status == 200) {
        if (http.status == 200) {
          responselist = http.response;
          // initialtableupdate(responselist)
          // alert(responselist);
          str = responselist.substring(responselist.indexOf("string\":"));
          str = str.substring(str.indexOf(":") + 3);
          str = str.replace("[", "");
          str = str.replace("]", "");
          str = str.replace("\"", "");
          str = str.replace("}", "");
          str = str.replace("\n", "");
          str = str.replace("(", "");
          str = str.replace(")", "");
          var element = str.split(', ');
          console.log(element);

          modelname = element[0].replace(/\'/g, "");
          ocrtype = element[1].replace(/\'/g, "");
          fullheight = element[2].replace(/\'/g, "");
          fullwidth = element[3].replace(/\'/g, "");
          noofparam = element[4].replace(/\'/g, "");
          header = element[5].replace(/\'/g, "");
          footer = element[6].replace(/\'/g, "");
          leftind = element[7].replace(/\'/g, "");
          defthre = element[8].replace(/\'/g, "");
          defcolcut = element[9].replace(/\'/g, "");
          defeyerangex = element[10].replace(/\'/g, "");
          defeyerangey = element[11].replace(/\'/g, "");          
          apiexposed = element[12].replace(/\'/g, "");
          apiurl = element[14].replace(/\'/g, "");
          apikey = element[13].replace(/\'/g, "");

          dilate = element[15].replace(/\'/g, "");
          erode = element[16].replace(/\'/g, "");

          if (ocrtype == "zocr"){
            ocrtype = "Zonal OCR model"
          } else if (ocrtype == "hocr"){
            ocrtype = "Hybrid OCR model"
          } else if (ocrtype == "socr"){
            ocrtype = "Simple OCR model"
          } else if (ocrtype == "kocr"){
            ocrtype = "Key Based OCR model"
          }

          if (apiexposed == "true"){
            $("#apicheckbox").prop("checked", true);
            $("#apioptions").css("display", "inline");
          } else if (apiexposed == "false"){
            $("#apicheckbox").prop("checked", false);
            $("#apioptions").css("display", "none");
          }

          document.getElementById("inputfullheight").value = fullheight;
          document.getElementById("inputfullwidth").value = fullwidth;
          document.getElementById("inputheader").value = header;
          document.getElementById("inputfooter").value = footer;
          document.getElementById("inputleftindex").value = leftind;
          document.getElementById("inputtotalparam").value = noofparam;
          document.getElementById("inputdefthre").value = defthre;
          document.getElementById("inputdefcolcut").value = defcolcut;
          document.getElementById("inputdefeyerangex").value = defeyerangex;
          document.getElementById("inputdefeyerangey").value = defeyerangey;
          document.getElementById("apiurl").value = apiurl;
          document.getElementById("apikey").value = apikey;

          document.getElementById("modaltitle").innerHTML = modelname;
          document.getElementById("ocrtype").innerHTML = ocrtype;

          // console.log(dilate + erode);

          document.getElementById("inputdefdilate").value = dilate;
          document.getElementById("inputdeferode").value = erode;

          $('#myModal').modal('show');
        } else {
          alert("failed to get model data")
        }
      }
    }
    http.send(params);
  }

  function myNavFunction(id) {
    $("#date-popover").hide();
    var nav = $("#" + id).data("navigation");
    var to = $("#" + id).data("to");
    console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
  }

  function fetchmodels(){

      var data = "";
      var xhr = new XMLHttpRequest();

      xhr.addEventListener("readystatechange", function() {
        if(this.readyState === 4) {
          createnewrow(this.responseText)
          // alert(this.responseText);
        }
      });

    xhr.open("POST", "http://localhost:3000/fetchpdfmodels");
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.send(data);
  }

  function createnewrow(response) {

      var modelsarray = response.split(",");
      var length = modelsarray.length;
      var i;
      var modelnames = [];
      for (i = 0; i < length; i++) {
        model = modelsarray[i];
        model = model.replace("\"", "");
        model = model.replace("[", "");
        model = model.replace("]", "");
        model = model.replace(" ", "");
        model = model.replace("\"", "");
        console.log(model);
        if ((model != "sysdiagrams") & (model != "models")) {
          // formnewrow(model);
          modelnames.push(model);
          // alert(model);
        }
      }
      formcard(modelnames);
    }

  function showapioptions(obj) {
      if ($(obj).is(":checked")) {
        $("#apioptions").css("display", "inline");
      } else {
        $("#apioptions").css("display", "none");
      }
    }

  function savedata(model){

    modelname = model;
    // defthreval = document.getElementById(inputdefthre).val;
    // defcolcutval = document.getElementById(inputdefcolcut).val;
    // defeyerangex = document.getElementById(inputdefeyerangex).val;
    // defeyerangey = document.getElementById(inputdefeyerangey).val;

    defthreval = $("#inputdefthre").val();
    defcolcutval = $("#inputdefcolcut").val();
    defeyerangex = $("#inputdefeyerangex").val();
    defeyerangey = $("#inputdefeyerangey").val();
    defdilate = $("#inputdefdilate").val();
    deferode = $("#inputdeferode").val();

    if ($(apicheckbox).is(":checked")) {
      apiexposed = "true";
    } else {
      apiexposed = "false";
    }

    var xhr = new XMLHttpRequest();
    var url = "http://localhost:3000/updatemodeledtails";
    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.setRequestHeader("modelname", modelname);
    xhr.setRequestHeader("apiexposed", apiexposed);
    xhr.setRequestHeader("defthre", defthreval);
    xhr.setRequestHeader("defcolcut", defcolcutval);
    xhr.setRequestHeader("defeyerangex", defeyerangex);
    xhr.setRequestHeader("defeyerangey", defeyerangey);
    xhr.setRequestHeader("defdilate", defdilate);
    xhr.setRequestHeader("deferode", deferode);

    // xhr.send(JSON.stringify(json));
    json = '{hi:hi}'
    xhr.send(json);
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        var json = JSON.parse(xhr.responseText);
        var output = xhr.response;
        console.log(output);
        $('#myModal').modal('hide');
        alert("Model updated successfully");
        // return "done";
      }
    }

  }

  </script>

</body>

</html>
